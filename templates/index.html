<!DOCTYPE html>
<html>
  <head>
    <title>ShowCase AI Video Editor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
      }

      h1,
      h2 {
        text-align: center;
        margin-top: 50px;
      }

      form {
        text-align: center;
        margin-top: 50px;
      }

      input[type="file"] {
        margin-top: 20px;
      }

      input[type="submit"] {
        margin-top: 20px;
        background-color: #4caf50;
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      input[type="submit"]:hover {
        background-color: #45a049;
      }

      hr {
        margin-top: 50px;
      }

      img {
        display: block;
        margin: auto;
        max-width: 100%;
        margin-top: 50px;
      }

      video {
        display: block;
        margin: auto;
        margin-top: 50px;
      }

      #transcription {
        margin-top: 50px;
        padding: 20px;
        border: 1px solid #ccc;
        background-color: #f2f2f2;
      }

      #timings-link {
        display: block;
        margin: auto;
        margin-top: 20px;
        text-align: center;
      }

      #generate-script-button {
        display: block;
        margin: auto;
        margin-top: 20px;
        text-align: center;
      }
    </style>
  </head>

  <body>
    <h1>ShowCase AI Video Editor</h1>

    <!-- <p id="showmessage" class="text-center"></p> -->

    <div class="modal fade" id="showmessage" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="display: none">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header border-0">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body text-center" style="color: green">Video Uploaded Successfully</div>
          <div class="modal-footer border-0"></div>
        </div>
      </div>
    </div>
    <!-- false message -->

    <div class="modal fade" id="showmessage2" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="display: none">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header border-0">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body text-center" style="color: red">Please select video</div>
          <div class="modal-footer border-0"></div>
        </div>
      </div>
    </div>

    <form id="transcription-form" method="POST" enctype="multipart/form-data" action="{{ url_for('upload_file') }}">
      <input type="file" name="file" class="video-input" accept="image/*,video/*" multiple /><br />
      <input type="submit" value="Upload Videos" id="uploadButton" />
    </form>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
      $(document).ready(function () {
        $("#uploadButton").click(function (e) {
          // Get the total number of selected files across all inputs
          var totalFiles = $(".video-input")[0].files.length;

          if (totalFiles > 0) {
            e.preventDefault();
            // $("#showmessage").html("<p style='color: green;'>Video Uploaded Successfully</p>");
            $("#showmessage").modal("show");

            // $('#showmessage').css('display','block');
            $('form#transcription-form').submit();
            e.preventDefault();
          } else {
            e.preventDefault();
            // $("#showmessage").html("<p style='color: red;'>Video Uploaded Successfully</p>");
            $("#showmessage2").modal("show");
          }

          console.log("Total number of files selected: " + totalFiles);
        });
      });
    </script>

    <hr />
    <!--  <h2>Uploaded Images:</h2>-->

    {% for image_file in image_files %}

    <img src="{{ url_for('static', filename='upload/' + image_file) }}" alt="{{ image_file }}" />
    {% endfor %}
    <h2>Uploaded Videos:</h2>
    <div class="container">
      <div class="row">
        {% for video_file in video_files %}
        <div class="col-lg-4">
          <video class="w-100" height="360" controls>
            <source src="{{ url_for('static', filename='upload/' + video_file) }}" type="video/mp4" />
            Your browser does not support the video tag.
          </video>
        </div>
        {% endfor %}
      </div>
    </div>

    {% if video_files %}
    <form method="get" action="/delete_videos">
      <button type="submit">Delete All Videos</button>
    </form>
    <hr />
    <h2>Transcription:</h2>
    <form method="POST" action="{{ url_for('generate_script') }}">
      {% for video_file in video_files %}
      <input type="checkbox" name="video_filenames[]" value="{{ video_file }}" />{{ video_file }}<br />
      {% endfor %}
      <input type="submit" value="Generate Script" id="generate-script-button" />
    </form>

    <div id="transcription">
      {% if transcript %}
      <h3>Generated Script:</h3>
      <pre>{{ transcript }}</pre>
      {% endif %}
    </div>
    <a href="{{ url_for('timings') }}" id="timings-link">Enter Timings</a>
    {% endif %}
<!--    &lt;!&ndash; The Modal &ndash;&gt;-->
<!--    <div id="uploadSuccessModal" class="modal">-->
<!--      <div class="modal-content">-->
<!--        <span class="close" id="closeModal">&times;</span>-->
<!--        <p>Files uploaded and saved successfully!</p>-->
<!--      </div>-->
<!--    </div>-->
  </body>
  <script>
    var modal = document.getElementById("uploadSuccessModal");

    // Get the <span> element that closes the modal
    var span = document.getElementById("closeModal");

    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
      modal.style.display = "none";
    };
  </script>
</html>
